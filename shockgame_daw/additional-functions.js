var instructions_1a_text = function(){
    var instructions = [
	"<div align=center><b>Please read all following instructions very carefully.</b><br><br>It takes some time, but otherwise you will not know what to do.</div>",
   "<div align=center>In this game, you will be making decisions in social contexts. Overall, the task will involve first choosing to enter rooms and then choosing buttons in such a way that the outcomes you desire are achieved.<br><br>The following instructions will give more details.</div>", 	
    "<div align=center>First, you will be opening a door to find one of two different rooms.<br><br>The green and yellow rooms below are examples of rooms you might see:<br><br><img style='margin:0px auto;display:block;height:200px' src='img/example_rooms_2.png'/><br><br>We will use these rooms to practice.</div>", 
    "<div align=center>Each room has <b>two</b> buttons in it.<br><br>For example, these are the two buttons that are found in the green room:<br><br><img style='margin:0px auto;display:block;height:200px' src='img/example_green_buttons.png'/><br>Each button is connected to its own shock-generating machine. Once you arrive in the room you chose, you will select one of the two buttons, which <b>might</b> result in shocks being delivered to someone.</div>",
    "<div align=justify>Sometimes, the button will deliver shock. The shock is represented by three bolts and painful facial expressions.<img style='margin:0px auto;display:block;height:400px' src='img/3_8.png'/><br>Sometimes, the button won't work, meaning no shock will be exerted. No shock is represented by an empty circle.<img style='margin:0px auto;display:block;height:400px' src='img/0_8.png'/></div>",
    "<div align=justify>Some buttons are faulty and <b>often do not deliver painful shocks</b> to the person connected to the machine. These 'faulty' buttons might occasionally shock the person, but most of the time they will not shock.<br><br>Other buttons rarely malfunction and <b>often do deliver painful shocks.</b> These buttons might occasionally not deliver shocks, but most of the time they will shock.<br><br>You will encounter both types of buttons.</div>",
    "<div align=justify>You will now learn how to select a certain button.<br><br>In each room, you can choose the left button by pressing the <b>'F' key</b> and the right button by pressing the <b>'J' key</b>.<br><br>After activating a button, you will then see whether shocks were exerted or not.<br><br>Try practicing this a few times. In the following practice phase, always pick the button that is highlighted.</div>"
    ];
    return instructions
};

var instructions_1b_text = function(){
    var instructions = [
    "<div align=center>You may have noticed that the highlighted button you chose was <b>likely to deliver shocks.</b> It delivered shocks most of the time.<br><br><img style='margin:0px auto;display:block;height:100px' src='img/green_stim_1.png'/><br>Different buttons have different likelihoods of exerting shock. To see this, you are going to try picking another button and observe the shocks it delivers.</div>"
    ];
    return instructions
};

var instructions_1c_text = function(){
    var instructions = [
    "<div align=justify>See, this highlighted button was <b>more likely to not deliver shocks.</b> It did not deliver shocks most of the time.<br><br><img style='margin:0px auto;display:block;height:100px' src='img/yellow_stim_1.png'/><br>In the following practice phase, you can choose between two buttons and try to figure out which one is likely to shock and which one is not.<br><br>Each button will sometimes come up on the right and sometimes come up on the left. Which side a button appears on does not matter. For instance, left is not luckier than right. </div>"
    ];
    return instructions
};

var instructions_1d_text = function(){  
    var instructions = ["<div align=justify>Nice! You should have learned that this button <i>often</i> <b>did not deliver shocks</b>:<br><br><img style='margin:0px auto;display:block;height:100px' src='img/green_stim_1.png'/><br>Meanwhile, this button <i>often</i> <b>did deliver shocks</b>:<br><br><img style='margin:0px auto;display:block;height:100px' src='img/green_stim_2.png'/><br>However, even if a button has been likely to deliver shocks <i>so far</i>, you can't be sure that it will continue to usually deliver shocks <i>all the time</i>.<br><br>For each button, its likelihood of exerting shock will slowly change during the game. In other words, a button that is likely to shock <i>now</i> will stay that way <i>for a while</i>.<br><br> If you wish to minimize the painful shocks delivered, you must concentrate to find the button that is less likely to shock at each point in time.</div>",
	"<div align=justify>Now that you know how to pick buttons, you can learn how to play the rest of the game.<br><br>On each trial, in order to enter into a room with buttons, you will first have to <b>choose one of two doors to open.</b> These doors are examples of the doors you might see:<br><br><img style='margin:0px auto;display:block;height:100px' src='img/example_doors.png'/><br>Each of these doors can open to either room, but one will <i>mostly</i> open to the yellow room, and the other <i>mostly</i> to the green room. The room that a door <i>usually</i> opens to <b>will not</b> change during the game. For example, if the brown door <i>usually</i> opens to the yellow room, it will continue to <i>usually</i> do so for the entire game.</div>",
    "<div align=justify>Now you will practice picking doors to get to different rooms.<br><br>Like you did to choose buttons, you can open the left door by pressing the <b>'F' key</b> and the right door by pressing the <b>'J' key</b>.</div>",
    ];
    return instructions
};

var instructions_1e_text = function(){  
    var instructions = ["<div align=justify>Great! You should have learned that picking the green door <i>usually</i> leads to yellow room. Meanwhile, picking the brown door <i>usually</i> leads to green room.<br><br>Now we can put together the two steps and practice playing the whole game.</div>",
	    "<div align=justify>Here are a few hints before you start: <br><br>Hint #1:<br>Remember which buttons are likely to shock and which are not. How likely a given button is to shock changes <i>slowly</i>, so a button that delivers barely any shocks <i>now</i> will be very likely to not shock <i>in the near future</i>.<br><br>Hint #2:<br>Each button is independent. Just because one button is likely to shock, does <b>not</b> mean another button (for example, the other button in the room) barely shocks.<br><br>Hint #3:<br>The door you choose is important. You may notice that a button found in a certain room is more likely to shock than a button in the other room. In order to reach a particular button, you must choose the door that <i>often</i> leads to the room containing that button. In short, you can find the buttons you are looking for by choosing the door that takes you to the right room.</div>",
	    "<div align=justify>Our advice is to think carefully about your strategy, but also to trust your instincts. If you wish to minimize the painful shocks being delivered to the other person, you will have to concentrate. There is an element of chance, but a lot of room for skill as well.<br><br>Now, you will do <b>15 practice trials</b>. These don't count, and have no time limit in order to help you learn.</div>"];
    return instructions
};

var instructions_2_text = function(){
    var instructions_2 = ["<div align=justify>Ok, you've finished all practice phases.<br><br> In the real game, you will find new rooms (purple and red) with new buttons and a new person receiving shock. However, the rules and the doors will be the same.<br><br>Also, we are only going to give you <b>2 seconds</b> for each choice of doors or buttons. At the beginning that won't seem like very much time and you may find the task difficult. Over time, as you learn to play, you will find that 2 seconds is enough time to make good decisions.<br><br>If you want to reduce the painful shocks delivered to the other person, you could do so by going into rooms and trying to choose buttons that <i>usually</i> do not shock. Remember, the chances a button will not shock changes slowly over time, so you need to concentrate and be flexible to keep track of which doors and buttons are likely to shock or not shock right now.<br><br>Now, you will play the full game for <b>125 trials</b>.</div>"];
    return instructions_2
}
    

function createMemberInNormalDistribution(mean,std_dev){
	return mean + (gaussRandom()*std_dev);
}
/*
* Returns random number in normal distribution centering on 0.
* ~95% of numbers returned should fall between -2 and 2
*/
function gaussRandom() {
	var u = 2*Math.random()-1;
	var v = 2*Math.random()-1;
	var r = u*u + v*v;
	/*if outside interval [0,1] start over*/
	if(r == 0 || r > 1) return gaussRandom();

	var c = Math.sqrt(-2*Math.log(r)/r);
	return u*c;

	/* todo: optimize this algorithm by caching (v*c) 
	* and returning next time gaussRandom() is called.
	* left out for simplicity */
}

function shuffle(o){
	for(var j, x, i = o.length; i; j = Math.floor(Math.random() * i), x = o[--i], o[i] = o[j], o[j] = x);
	return o;
}

var images = [
'img/start_room.png',
'img/start_stim_1_pressed.png',
'img/start_stim_1_deact.png',
'img/start_stim_1.png',
'img/start_stim_2_pressed.png',
'img/start_stim_2_deact.png',
'img/start_stim_2.png',

'img/example_rooms.png',
'img/example_rooms_2.png',
'img/example_green_buttons.png',
'img/example_doors.png',

'img/noreward.png',
'img/noshock.png',

'img/purple_room.png',
'img/purple_stim_1_deact.png',
'img/purple_stim_1_pressed.png',
'img/purple_stim_1.png',
'img/purple_stim_2_deact.png',
'img/purple_stim_2_pressed.png',
'img/purple_stim_2.png',

'img/red_room.png',
'img/red_stim_1_deact.png',
'img/red_stim_1_pressed.png',
'img/red_stim_1.png',
'img/red_stim_2_deact.png',
'img/red_stim_2_pressed.png',
'img/red_stim_2.png',

'img/green_room.png',
'img/green_stim_1_deact.png',
'img/green_stim_1_pressed.png',
'img/green_stim_1.png',
'img/green_stim_2_deact.png',
'img/green_stim_2_pressed.png',
'img/green_stim_2.png',

'img/yellow_room.png',
'img/yellow_stim_1_deact.png',
'img/yellow_stim_1_pressed.png',
'img/yellow_stim_1.png',
'img/yellow_stim_2_deact.png',
'img/yellow_stim_2_pressed.png',
'img/yellow_stim_2.png',    

'img/0_1.png',
'img/0_2.png',
'img/0_3.png',
'img/0_4.png',
'img/0_5.png',
'img/0_6.png',
'img/0_7.png',
'img/0_8.png',
'img/3_1.png',
'img/3_2.png',
'img/3_3.png',
'img/3_4.png',
'img/3_5.png',
'img/3_6.png',
'img/3_7.png',
'img/3_8.png', 
];

function save_data(data,table_name){
	
for (i = 0; i < data.length; i++) {
	delete data[i].internal_chunk_id;
	delete data[i].trial_index_global;
	delete data[i].trial_type;
	/*if (table_name == "space_mult_subinfo") {
		delete data[i].key_press;
		delete data[i].rt;
		delete data[i].trial_index;
		}*/
	}
		
	$.ajax({
		type:'post',
		cache: false,
		url: 'savedata.php', // change this to point to your php file.
		// opt_data is to add additional values to every row, like a subject ID
		// replace 'key' with the column name, and 'value' with the value.
		data: {
			table: table_name,
			json: JSON.stringify(data),
		},
		success: function(){
			console.log("sucess");
		}// write the result to javascript console
		//success: function(output) { console.log(output); } // write the result to javascript console
	});
}

function getQueryVariable(variable)
{
       var query = window.location.search.substring(1);
       var vars = query.split("&");
       for (var i=0;i<vars.length;i++) {
               var pair = vars[i].split("=");
               if(pair[0] == variable){return pair[1];}
       }
       return(false);
}
